# Stateパターン
## 概要
- ある状態からあるアクションにより別の状態に遷移する状態遷移図をコーディングするが、状態遷移図が変化しても容易に対応できる構造を持つ。
- オブジェクト(Context)の内部状態に合わせて、異なるふるまいを採用する(＝Strategyパターン)。振る舞いの中にはオブジェクト(Context)自身の内部状態を変える動作もある。これにより、自らの状態を変える。これによりあたかも別のクラスに変わったかのように動作する。
## 状態マシンのコーディングステップ
- 定義されている状態を集める。
- 状態を保持するためのインスタンス変数を作成し、状態ごとの値を決める
- このシステムで起こりうるすべてのアクションを集める。
- アクションごとに条件分を使って、それぞれの状態でどのような振る舞いが適切かを決定するメソッドを作成する。
## ノウハウ
- 状態遷移が固定されている場合は、Contextの中に状態遷移を記述する。状態遷移が状況によって変わる場合は状態クラスに記述する。(状態クラスに状態遷移を記述すると状態クラス間に依存関係を作ってしまう、というデメリットがある)
- クライアントが状態クラスと直接やり取りは行わない。状態を監視するのはContextの役割。
- Contextが複数あっても状態を共有することは可能。
## 気づき
- 「ふるまいを切り替える」点はStrategyパターンと同じ。Strategyパターンはふるまいを選択するのは起動時だけだが、Stateパターンは状況が変わるたびに変える、という点が違う。
- Strategyパターンは、クライアントが戦略を指定する。Stateパターンは、状況が戦略を指定する。
- 「クライアントは具体的な戦略を意識せず、オブジェクトに対するアクションのみを意識している場合」「戦略実行の結果によって状況が変わり、それに合わせて戦略を変えるような場合」などのケースはStateパターンを使うとよい。